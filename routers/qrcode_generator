from fastapi import APIRouter, Query, Response
import qrcode
from io import BytesIO

router = APIRouter(prefix="/qrcode", tags=["QRCode Generator"])

@router.get("/generate", response_class=Response)
def generate_qrcode(data: str = Query(..., description="The data to encode in the QR code"), box_size: int = Query(10, ge=1, le=50), border: int = Query(4, ge=0, le=10)):
    """Generate a QR code image from the input data."""
    qr = qrcode.QRCode(
        version=None,
        error_correction=qrcode.constants.ERROR_CORRECT_M,
        box_size=box_size,
        border=border,
    )
    qr.add_data(data)
    qr.make(fit=True)

    img = qr.make_image(fill_color="black", back_color="white")
    buf = BytesIO()
    img.save(buf, format='PNG')
    buf.seek(0)

    return Response(content=buf.read(), media_type="image/png")